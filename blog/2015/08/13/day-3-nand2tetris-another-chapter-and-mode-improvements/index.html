<!DOCTYPE html>
<html lang="en-us">
  <head>
    <title>Day 3 Nand2Tetris: Another Chapter and mode improvements - Diego Berrocal</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="Diego Berrocal">
    <meta name="description" content="In which I keep telling the story of the development of nand2tetris.el mode">
    <meta name="keywords" content="emacs, nand2tetris, elisp">
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Fira+Sans:400,700,400italic,700italic|Lora:400,700|Source+Code+Pro:400,700">
    <link rel="stylesheet" href="/media/css/normalize.css">
    <link rel="stylesheet" href="/media/css/dark.css" id="darkTheme">
    <link rel="stylesheet" href="/media/css/light.css" id="lightTheme">
    <link href="http://cestdiego.github.io/atom.xml" type="application/atom+xml" rel="alternate" title="Diego Berrocal" />
    <script>
     var lightTheme = document.querySelector("#lightTheme");
     var darkTheme = document.querySelector("#darkTheme");

     var toggleTheme = function () {
         var isDefaultDisabled = lightTheme.disabled;
         darkTheme.disabled = isDefaultDisabled;
         lightTheme.disabled = !isDefaultDisabled;

         var switchLights = document.querySelector(".switch-lights");
         switchLights.textContent = "lights " + (isDefaultDisabled ? "off" : "on");

         return !isDefaultDisabled;
     };

     if (localStorage.darkTheme === "1") {
         toggleTheme();
     }
    </script>
    <link rel="stylesheet" href="/media/css/main.css">
    <noscript>
        <style>
         .toggle-colors{
             display: none;
         }
        </style>
    </noscript>
  </head>

  <body>
    <div id="wrapper">
    <nav class="site-nav">
      <ul class="links">
        <li><a href="/">Diego Berrocal</a></li>
         <li><a href="/about/">about</a></li>
        <li><a href="/blog/">blog</a></li>
        <li><a href="/atom.xml">atom</a></li>
        <li><button class="switch-lights">lights off</button></li>
      </ul>
    </nav>

    <article class="post">
      <header>
          <h1 class="post-title">Day 3 Nand2Tetris: Another Chapter and mode improvements</h1>
          <time class="post-date">Aug 13, 2015</time>
      </header>
      <p>
Just after finishing the nand2tetris hdl file mode I think I made a mistake
naming it `nand2tetris` mode because after Week 3 the use of hdl files drops
dramatically. And the use of <code>assembler</code> files that are in some <code>Hack Assembly</code>
language are the main focus. Makes sense, but I'm kinda sad that the mode was
just useful for a couple of "weeks". Still I hope it is of use for other people.
</p>

<p>
Anyway, I made some other improvements on the nand2tetris hdl mode (I think I
might rename the mode later on, you'll see why) 
</p>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">Company</h2>
<div class="outline-text-2" id="text-1">
<p>
I added support for the popup from company, it just looks like this:
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp"><span style="color: #A1EFE4;">(</span><span style="color: #F92672;">defvar</span> <span style="color: #FD971F;">nand2tetris-builtin-chips</span>
  '<span style="color: #E6DB74;">(</span><span style="color: #66D9EF;">(</span><span style="color: #E6DB74;">"Add16"</span> . <span style="color: #FD971F;">(</span><span style="color: #A6E22E;">(</span><span style="color: #E6DB74;">"description"</span> .
                 <span style="color: #E6DB74;">"16-bit bitwise And:</span>

<span style="color: #E6DB74;">IN a[16], b[16];</span>
<span style="color: #E6DB74;">OUT out[16];</span>

<span style="color: #E6DB74;">for i = 0..15: out[i] = (a[i] and b[i])"</span><span style="color: #A6E22E;">)</span>
                <span style="color: #A6E22E;">(</span><span style="color: #E6DB74;">"spec"</span> . <span style="color: #E6DB74;">"Add16(a= ,b= ,out= )"</span><span style="color: #A6E22E;">)</span><span style="color: #FD971F;">)</span><span style="color: #66D9EF;">)</span>
    <span style="color: #75715E;">;; </span><span style="color: #75715E;">...</span>
    <span style="color: #E6DB74;">)</span><span style="color: #A1EFE4;">)</span>

<span style="color: #A1EFE4;">(</span><span style="color: #F92672;">defun</span> <span style="color: #A6E22E;">company-nand2tetris--doc-buffer</span> <span style="color: #E6DB74;">(</span>candidate<span style="color: #E6DB74;">)</span>
  <span style="color: #75715E;">"Return documentation buffer for chosen CANDIDATE."</span>
  <span style="color: #E6DB74;">(</span><span style="color: #F92672;">let</span> <span style="color: #66D9EF;">(</span><span style="color: #FD971F;">(</span>doc <span style="color: #A6E22E;">(</span>cdr <span style="color: #E6DB74;">(</span>assoc <span style="color: #E6DB74;">"description"</span>
                         <span style="color: #66D9EF;">(</span>assoc candidate nand2tetris-builtin-chips<span style="color: #66D9EF;">)</span><span style="color: #E6DB74;">)</span><span style="color: #A6E22E;">)</span><span style="color: #FD971F;">)</span><span style="color: #66D9EF;">)</span>
    <span style="color: #66D9EF;">(</span>and doc <span style="color: #FD971F;">(</span>nand2tetris-doc-buffer doc<span style="color: #FD971F;">)</span><span style="color: #66D9EF;">)</span><span style="color: #E6DB74;">)</span><span style="color: #A1EFE4;">)</span>


<span style="color: #75715E;">;;;</span><span style="color: #75715E;">###</span><span style="color: #FD971F; font-weight: bold; font-style: italic; text-decoration: underline;">autoload</span>
<span style="color: #A1EFE4;">(</span><span style="color: #F92672;">defun</span> <span style="color: #A6E22E;">company-nand2tetris</span> <span style="color: #E6DB74;">(</span>command <span style="color: #66D9EF;">&amp;optional</span> arg <span style="color: #66D9EF;">&amp;rest</span> ignored<span style="color: #E6DB74;">)</span>
  <span style="color: #75715E;">"Company backend for `</span><span style="color: #AE81FF;">nand2tetris-mode</span><span style="color: #75715E;">'."</span>
  <span style="color: #E6DB74;">(</span>interactive <span style="color: #66D9EF;">(</span>list 'interactive<span style="color: #66D9EF;">)</span><span style="color: #E6DB74;">)</span>
  <span style="color: #E6DB74;">(</span><span style="color: #F92672;">cl-case</span> command
    <span style="color: #66D9EF;">(</span>interactive <span style="color: #FD971F;">(</span>company-begin-backend 'company-nand2tetris<span style="color: #FD971F;">)</span><span style="color: #66D9EF;">)</span>
    <span style="color: #66D9EF;">(</span>prefix <span style="color: #FD971F;">(</span>company-nand2tetris--prefix<span style="color: #FD971F;">)</span><span style="color: #66D9EF;">)</span>
    <span style="color: #66D9EF;">(</span>candidates <span style="color: #FD971F;">(</span>company-nand2tetris--candidates arg<span style="color: #FD971F;">)</span><span style="color: #66D9EF;">)</span>
    <span style="color: #66D9EF;">(</span>doc-buffer <span style="color: #FD971F;">(</span>company-nand2tetris--doc-buffer arg<span style="color: #FD971F;">)</span><span style="color: #66D9EF;">)</span>
    <span style="color: #66D9EF;">(</span>annotation <span style="color: #FD971F;">(</span>company-nand2tetris--annotation arg<span style="color: #FD971F;">)</span><span style="color: #66D9EF;">)</span><span style="color: #E6DB74;">)</span><span style="color: #A1EFE4;">)</span>
</pre>
</div>

<p>
So I just put one example of the many alists... I had to add another
<code>description</code> entry and was mostly done by hand. I found it very useful when
doing the PC, ALU and RAM chips :)
</p>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">ElDoc (It works better now!)</h2>
<div class="outline-text-2" id="text-2">
<p>
SO after lots of reading on how regular expressions work in Emacs I think I got
it now :) at least I feel way more comfortable than before, even though this is
my first go at emacs lisp package development I feel confident that there are
bearable rough edges.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp"><span style="color: #75715E;">;;; </span><span style="color: #75715E;">ElDoc</span>
<span style="color: #A1EFE4;">(</span><span style="color: #F92672;">require</span> '<span style="color: #AE81FF;">eldoc</span><span style="color: #A1EFE4;">)</span>

<span style="color: #A1EFE4;">(</span><span style="color: #F92672;">defun</span> <span style="color: #A6E22E;">get-chip-at-line</span> <span style="color: #E6DB74;">()</span>
  <span style="color: #75715E;">"Gets the chip currently used, so that placing the cursor at</span>
<span style="color: #75715E;">any point in the line:</span>
<span style="color: #75715E;">   Not16 (in=a, out=out)</span>
<span style="color: #75715E;">Will return Not16"</span>
  <span style="color: #E6DB74;">(</span><span style="color: #F92672;">save-excursion</span>
    <span style="color: #66D9EF;">(</span>beginning-of-line<span style="color: #66D9EF;">)</span>
    <span style="color: #66D9EF;">(</span>search-forward-regexp
     <span style="color: #FD971F;">(</span>rx <span style="color: #A6E22E;">(</span>group <span style="color: #E6DB74;">(</span>* word<span style="color: #E6DB74;">)</span><span style="color: #A6E22E;">)</span>
         <span style="color: #A6E22E;">(</span>? space <span style="color: #A6E22E;">)</span> <span style="color: #E6DB74;">"("</span><span style="color: #FD971F;">)</span><span style="color: #66D9EF;">)</span>
    <span style="color: #66D9EF;">(</span>match-string <span style="color: #AE81FF;">1</span><span style="color: #66D9EF;">)</span><span style="color: #E6DB74;">)</span><span style="color: #A1EFE4;">)</span>

<span style="color: #A1EFE4;">(</span><span style="color: #F92672;">defun</span> <span style="color: #A6E22E;">nand2tetris-eldoc-function</span> <span style="color: #E6DB74;">()</span>
  <span style="color: #75715E;">"Get help on SYMBOL using `</span><span style="color: #AE81FF;">help</span><span style="color: #75715E;">'.</span>
<span style="color: #75715E;">Interactively, prompt for symbol."</span>
  <span style="color: #E6DB74;">(</span><span style="color: #F92672;">let</span> <span style="color: #66D9EF;">(</span><span style="color: #FD971F;">(</span>symbol <span style="color: #A6E22E;">(</span>get-chip-at-line<span style="color: #A6E22E;">)</span><span style="color: #FD971F;">)</span>
        <span style="color: #FD971F;">(</span>enable-recursive-minibuffers t<span style="color: #FD971F;">)</span><span style="color: #66D9EF;">)</span>
    <span style="color: #66D9EF;">(</span>message <span style="color: #FD971F;">(</span>cdr <span style="color: #A6E22E;">(</span>assoc <span style="color: #E6DB74;">"spec"</span> <span style="color: #E6DB74;">(</span>assoc symbol nand2tetris-builtin-chips<span style="color: #E6DB74;">)</span><span style="color: #A6E22E;">)</span><span style="color: #FD971F;">)</span><span style="color: #66D9EF;">)</span><span style="color: #E6DB74;">)</span><span style="color: #A1EFE4;">)</span>
</pre>
</div>

<p>
So now ElDoc information shows even if you don't have the cursor exactly at the
end of the CHIP.
</p>
</div>
</div>


<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3">nand2tetris material coming up</h2>
<div class="outline-text-2" id="text-3">
<p>
After completing week 5 I see that a custom assembly mode would be awesome for
nand2tetris and also maybe..syntax highlighting for the bit lines in the machine
code? so one could actually see what it means :) it would be awesome to have but
that might be very difficult, I'm gonna attempt to make the HackAssembly mode
with Keybindings to also Test the current assembly, just like <code>C-c C-c</code> does
currently in nand2tetris-mode.
</p>
</div>
</div>

    </article>

<footer class="site-footer">
    <div class="back-to-top">
        <a href="#">back to top</a>
        <a id="show-comments"  onclick="loadDisqus()"> show comments</a>
    </div>
    <script src="/media/js/main.js"></script>
    <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
        <script>
         (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
             (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                                  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
         })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

         ga('create', 'UA-40864129-3', 'auto');
         ga('send', 'pageview');
        </script>
            <div id="disqus_thread"></div>
            <script type="text/javascript">
             /* * * CONFIGURATION VARIABLES * * */
             var disqus_identifier = "/blog/2015/08/14/day-3-nand2tetris-another-chapter-and-mode-improvements";
             var disqus_url = "http://cestdiego.github.io/blog/2015/08/14/day-3-nand2tetris-another-chapter-and-mode-improvements";
             var disqus_shortname = 'cestdiego';

             /* * * DON'T EDIT BELOW THIS LINE * * */
             var ds_loaded = false;
             var le_top = document.getElementById("disqus_thread").offsetTop;

             function loadDisqus(){
                 ds_loaded = true;
                 (function() {
                     var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                     dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                     (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                 })();
                 document.getElementById("show-comments").style.visibility = "hidden"
             }

             var reload_disqus = function(){
                 DISQUS.reset({
                     reload: true,
                     config: function () {
                         this.page.identifier = cestdiego;
                     }
                 });
             }
            </script>
            <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
</footer>

    </div>
  </body>
</html>
